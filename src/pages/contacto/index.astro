---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Contacto">
  <div class="container-xl max-w-screen-xl py-7">
    <h1 class="mb-8">Conócenos</h1>
    <div class="row">
      <div class="flex-none w-56 w-lg-96 mb-10 mb-md-0">
        <h3>Reunámonos con nuestro equipo de expertos</h3>
        <ol class="mt-6">
          <li>
            Completa el formulario
            <span class="text-sm text-muted d-none d-lg-block">Proporciónanos un poco de información para entender tu necesidad y brindarte el seguimiento adecuado.</span>
          </li>
          <li>
            ¿Qué debes esperar?
            <span class="text-sm text-muted d-none d-lg-block"
              >Un miembro de nuestro equipo se pondrá en contacto contigo para programas una reunión a la hora que sea más conveniente para ti.</span
            >
          </li>
          <li>
            ¿Para qué es la reunión?
            <span class="text-sm text-muted d-none d-lg-block"
              >Conversaremos sobre los retos de tu negocio y te daremos detalle de cómo nuestra expertiz y soluciones pueden ayudarte a superarlos.</span
            >
          </li>
        </ol>
      </div>
      <div class="col col-lg-6 mx-auto">
        <form id="form" class="needs-validation" novalidate>
          <div class="mb-7">
            <h4 class="font-semibold mb-1">Datos</h4>
            <p class="text-sm text-muted"></p>
          </div>
          <div class="row g-5">
            <div class="col-md-6">
              <div class="">
                <label class="form-label" for="nombre">Nombre</label>
                <input type="text" class="form-control" id="nombre" required />
                <span class="mt-2 invalid-feedback">Este valor es requerido</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="">
                <label class="form-label" for="apellido">Apellido</label>
                <input type="text" class="form-control" id="apellido" required />
                <span class="mt-2 invalid-feedback">Este valor es requerido</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="">
                <label class="form-label" for="email">Email</label>
                <input type="email" class="form-control" id="email" required />
                <span class="mt-2 invalid-feedback">Este valor es requerido</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="">
                <label class="form-label" for="telefono">Teléfono</label>
                <input type="tel" class="form-control" id="telefono" pattern="[0-9]{10}" required />
                <span class="mt-2 invalid-feedback">Este valor es requerido</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="">
                <label class="form-label" for="empresa">Empresa</label>
                <input type="text" class="form-control" id="empresa" required />
                <span class="mt-2 invalid-feedback">Este valor es requerido</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="">
                <label class="form-label" for="puesto">Puesto</label>
                <select class="form-select" id="puesto" aria-label="puesto" required>
                  <option selected>Director</option>
                  <option>Gerente</option>
                  <option>Jefatura/Supervisión</option>
                  <option>Auxiliar/Asistente</option>
                  <option>Otro</option>
                </select>
                <span class="mt-2 invalid-feedback">Este valor es requerido</span>
              </div>
            </div>
            <div class="col-11">
              <div class="">
                <label class="form-label" for="num_empleados">Número de empleados</label>
                <input type="number" class="form-control" id="num_empleados" min="1" required />
                <span class="mt-2 invalid-feedback">Debe de ser un número mayor que cero</span>
                <span class="mt-2 d-block">Nota importante: Nuestras soluciones han sido diseñadas para requerimientos a partir de 30 empleados.</span>
              </div>
            </div>
          </div>
          <hr class="mt-10 mb-8" />
          <div class="mb-7">
            <h4 class="font-semibold mb-1">Interés</h4>
            <p class="text-sm text-muted"></p>
            <div class="mt-7">
              <div class="d-flex mb-5">
                <div class="me-3">
                  <input class="form-check-input" type="checkbox" name="check_administracion_personal" id="check_administracion_personal" />
                </div>
                <div>
                  <label class="form-label mb-0" for="check_administracion_personal"> Administración de personal</label>
                  <p class="text-sm text-muted"></p>
                </div>
              </div>
              <div class="d-flex mb-5">
                <div class="me-3">
                  <input class="form-check-input" type="checkbox" name="check_prenomina" id="check_prenomina" />
                </div>
                <div>
                  <label class="form-label mb-0" for="check_prenomina"> Prenómina</label>
                  <p class="text-sm text-muted"></p>
                </div>
              </div>
              <div class="d-flex mb-5">
                <div class="me-3">
                  <input class="form-check-input" type="checkbox" name="check_ehub" id="check_ehub" />
                </div>
                <div>
                  <label class="form-label mb-0" for="check_ehub"> eHub</label>
                  <p class="text-sm text-muted"></p>
                </div>
              </div>
              <div class="d-flex mb-5">
                <div class="me-3">
                  <input class="form-check-input" type="checkbox" name="check_servicios_personal" id="check_servicios_personal" />
                </div>
                <div>
                  <label class="form-label mb-0" for="check_servicios_personal"> Servicios al personal</label>
                  <p class="text-sm text-muted"></p>
                </div>
              </div>
              <div class="d-flex mb-5">
                <div class="me-3">
                  <input class="form-check-input" type="checkbox" name="check_tiempo_asistencia" id="check_tiempo_asistencia" />
                </div>
                <div>
                  <label class="form-label mb-0" for="check_tiempo_asistencia"> Tiempo y asistencia</label>
                  <p class="text-sm text-muted"></p>
                </div>
              </div>
              <div class="d-flex mb-5">
                <div class="me-3">
                  <input class="form-check-input" type="checkbox" name="check_control_accesos" id="check_control_accesos" />
                </div>
                <div>
                  <label class="form-label mb-0" for="check_control_accesos"> Control de accesos</label>
                  <p class="text-sm text-muted"></p>
                </div>
              </div>
              <div class="d-flex mb-5">
                <div class="me-3">
                  <input class="form-check-input" type="checkbox" name="check_contratistas" id="check_contratistas" />
                </div>
                <div>
                  <label class="form-label mb-0" for="check_contratistas"> Contratistas</label>
                  <p class="text-sm text-muted"></p>
                </div>
              </div>
              <div class="d-flex mb-5">
                <div class="me-3">
                  <input class="form-check-input" type="checkbox" name="check_organizacion" id="check_organizacion" />
                </div>
                <div>
                  <label class="form-label mb-0" for="check_organizacion"> Organización</label>
                  <p class="text-sm text-muted"></p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-12">
            <div class="">
              <label class="form-label" for="comentario">Comentario</label>
              <span>(Opcional)</span>
              <textarea class="form-control" id="comentario" placeholder="" rows="3"></textarea>
            </div>
          </div>
          <div class="col-md-12 mt-4">
            <div class="">
              <label class="form-label" for="random">Captcha</label>
              <div id="random"></div>
              <input type="text" class="form-control" id="random-text" required />
              <span class="mt-2 invalid-feedback">Este valor es requerido</span>
            </div>
          </div>
          <hr class="mt-7 mb-7" />
          <div class="d-flex">
            <button type="submit" id="submit-btn" class="btn btn-primary ms-auto">¡Contáctanos!</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</Layout>

<script>
  init();

  //document.addEventListener("astro:after-swap", init);

  function init() {
    let code: string;
    const form = document.getElementById("form") as HTMLFormElement;
    const checks = [...document.querySelectorAll(".form-check-input")];

    createRandom();

    form.addEventListener(
      "submit",
      (event) => {
        event.preventDefault();
        event.stopPropagation();

        if (form.checkValidity() && isValidRandom()) {
          submitform();
        }

        if (!isValidRandom()) {
          createRandom();
        }

        form.classList.add("was-validated");
      },
      false
    );

    function submitform() {
      const intereses = checks
        .filter((item) => (item as HTMLInputElement).checked)
        .map((item) => item.id.replace("check_", ""))
        .join(";");

      const data = {
        Nombre: (document.getElementById("nombre") as HTMLInputElement)?.value,
        Apellido: (document.getElementById("apellido") as HTMLInputElement)?.value,
        Email: (document.getElementById("email") as HTMLInputElement)?.value,
        Telefono: (document.getElementById("telefono") as HTMLInputElement)?.value,
        Empresa: (document.getElementById("empresa") as HTMLInputElement)?.value,
        Puesto: (document.getElementById("puesto") as HTMLInputElement)?.value,
        NumEmpleados: (document.getElementById("num_empleados") as HTMLInputElement)?.value,
        Interes: intereses,
        Comentario: (document.getElementById("comentario") as HTMLInputElement)?.value,
      };

      fetch("https://api.sheetmonkey.io/form/tFyRFUtQHefaPEfgD1X9PG", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      }).then(() => {
        window.location.reload();
      });
    }

    function isValidRandom() {
      return (document.getElementById("random-text") as HTMLInputElement).value == code;
    }

    function createRandom() {
      (document.getElementById("random") as HTMLInputElement).innerHTML = "";

      const charsArray = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ@!#$%^&*";
      const lengthOtp = 6;
      const captcha = [];

      for (var i = 0; i < lengthOtp; i++) {
        var index = Math.floor(Math.random() * charsArray.length + 1);

        if (captcha.indexOf(charsArray[index]) == -1) captcha.push(charsArray[index]);
        else i--;
      }

      const canv = document.createElement("canvas");

      canv.id = "captcha";
      canv.width = 100;
      canv.height = 50;

      const ctx = canv.getContext("2d");

      if (!ctx) return;

      ctx.font = "25px Georgia";
      ctx.strokeText(captcha.join(""), 0, 30);

      code = captcha.join("");
      (document.getElementById("random") as HTMLElement).appendChild(canv);
    }
  }
</script>
